<div class="forgot-password-container" role="main">
  <mat-card class="forgot-password-card" [attr.aria-busy]="isLoading">
    <mat-card-header>
      <mat-card-title class="forgot-password-title">
        {{ emailSent ? 'Check Your Email' : 'Reset Password' }}
      </mat-card-title>
      <mat-card-subtitle>
        {{ emailSent ? 'We\'ve sent you a password reset link' : 'Enter your email to receive a reset link' }}
      </mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <!-- Success state - Email sent -->
      <div *ngIf="emailSent" class="email-sent-content">
        <mat-icon class="success-icon">mark_email_read</mat-icon>
        <p class="success-message">
          Please check your email inbox and click the reset link to create a new password.
        </p>
        <p class="help-text">
          If you don't see the email, check your spam folder or 
          <button 
            mat-button 
            color="primary" 
            type="button"
            (click)="emailSent = false; forgotPasswordForm.enable()"
            class="resend-button"
          >
            try again with a different email
          </button>
        </p>
      </div>

      <!-- Form state - Request reset -->
      <form 
        *ngIf="!emailSent"
        [formGroup]="forgotPasswordForm" 
        (ngSubmit)="onSubmit()" 
        novalidate
        autocomplete="on"
        role="form"
        aria-label="Forgot password form"
      >
        <!-- Email Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email Address</mat-label>
          <input 
            matInput 
            type="email" 
            formControlName="email" 
            autocomplete="email"
            spellcheck="false"
            [attr.aria-describedby]="getAriaDescribedBy('email')"
            [attr.aria-invalid]="emailControl.invalid && emailControl.touched"
            placeholder="Enter your email address"
            required
          >
          
          <mat-error 
            *ngIf="emailControl.invalid && emailControl.touched"
            [id]="emailErrorId"
            role="alert"
            aria-live="polite"
          >
            {{ getEmailErrorMessage() }}
          </mat-error>
        </mat-form-field>

        <!-- Global Error Message -->
        <div 
          *ngIf="error" 
          class="error-message"
          role="alert"
          aria-live="assertive"
        >
          {{ error.message }}
        </div>

        <!-- Submit Button -->
        <button 
          mat-raised-button 
          color="primary" 
          type="submit" 
          class="forgot-password-button full-width"
          [disabled]="forgotPasswordForm.invalid || isLoading"
          [attr.aria-label]="isLoading ? 'Sending reset email...' : 'Send reset email'"
        >
          <span *ngIf="!isLoading" class="button-content">
            Send Reset Email
          </span>
          
          <span *ngIf="isLoading" class="button-content">
            <mat-spinner diameter="20" aria-hidden="true"></mat-spinner>
            Sending...
          </span>
        </button>
      </form>
    </mat-card-content>

    <!-- Navigation Links -->
    <mat-card-actions class="card-actions">
      <div class="navigation-links">
        <a 
          routerLink="/login" 
          class="back-link"
          aria-label="Back to login"
        >
          <mat-icon>arrow_back</mat-icon>
          Back to Login
        </a>
        
        <a 
          routerLink="/register" 
          class="register-link"
          aria-label="Create a new account"
        >
          Don't have an account? Sign up
        </a>
      </div>
    </mat-card-actions>
  </mat-card>
</div>
